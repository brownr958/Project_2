<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Baseball Team Builder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="styles2.css">
  <script src="https://d3js.org/d3.v5.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
  <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script>
    var positions = {}

    function allowDrop(ev) {
      ev.preventDefault();
    }
    
    function drag(ev) {
      td_string = $(ev.target).find('td')[1].innerHTML + "-" + $(ev.target).find('td')[0].innerHTML + "-" + $(ev.target).find('td')[3].innerHTML
      console.log(td_string)
      ev.dataTransfer.setData("text", td_string);
    }
    
    function drop(ev) {
      ev.preventDefault();
      var data = ev.dataTransfer.getData("text");
      target = $(ev.target)
      target.empty()
      target.append(data)
      console.log("Drop event ---")
      positions['cf'] = d3.select(".cf").text()
      positions['c'] = d3.select(".c").text()
      positions['fb'] = d3.select(".fb").text()
      positions['sb'] = d3.select(".sb").text()
      positions['tb'] = d3.select(".tb").text()
      positions['ss'] = d3.select(".ss").text()
      positions['lf'] = d3.select(".lf").text()
      positions['rf'] = d3.select(".rf").text()
      positions['dh'] = d3.select(".dh").text()
      
      filter_list = Object.values(positions).filter(item => item.length > 1)
      console.log(filter_list)


    d3.json(`http://localhost:5000/playerLineup/${filter_list}`).then((data) => {
          //Put the code to graph the data on plot2
          console.log(data)
         

          var pos =  data.map(x => x.Name);
          var pos2 =  data.map(x => x.WAR);
          var trace2 = {
            x: pos,
            y: pos2,
            type: "bar"
 };
          var bar = [trace2];
          var layouts = {
          //   yaxis: {
          //   autotick: false,
          //   ticks: 'outside',
          //   tick0: 0,
          //   dtick: 10,
          //   ticklen: 108
          // }

          
         title: "'Bar' Chart"
         
 };
     Plotly.newPlot("plot2", bar, layouts);
       }
      )
      

      // ev.target.innerHTML.append(data)
      // ev.target.appendChild(document.getElementById(data));
      // ev.target.textContent = data;
    }
  </script>

</head>

<body style="background: rgb(22, 22, 22);">
  <div class="wrapper">
    <div class="jumbotron text-center" style="background-image: url(https://sentrysportslighting.com/wp-content/uploads/2016/05/athletic-field_panoramic.png); height: 400px; background-position-x: center;">
      <br>
      <br>
      <h1 style="color: white;"><b>Fantasy Baseball Lineup Builder</b></h1>
      <p style="color: white;">Create a baseball lineup of players' seasons dating from 1969 to 2020 using a salary cap to see how stacked your dream team is.</p>
    </div>
    <hr size="50px" style="background-color: #ffffff; opacity: inherit;"> 
    <div class="container-fluid" style="margin-top: 50px">
      <div class="row margin-top-50">
        <div class="col-md-10 offset-md-1">
          <div id="table-area" class="">
            <table id="player-table" class="table table-dark table-striped table-hover" style="text-align: center;">
              <thead>
                <tr>
                  <th class="table-head">Season</th>
                  <th class="table-head">Name</th>
                  <th class="table-head">Team</th>
                  <th class="table-head">Position</th>
                  <th class="table-head">Age</th>
                  <th class="table-head">AVG</th>
                  <th class="table-head">OBP</th>
                  <th class="table-head">SLG</th>
                  <th class="table-head">OPS</th>
                  <th class="table-head">AB</th>
                  <th class="table-head">H</th>
                  <th class="table-head">R</th>
                  <th class="table-head">HR</th>
                  <th class="table-head">RBI</th>
                  <th class="table-head">SB</th>
                  <th class="table-head">Off</th>
                  <th class="table-head">WAR</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-12">
      <div class="col-lg-6">
        <svg width="960" height="720">
          <image href="https://i.imgur.com/KtWoklI.jpg" x="0" y="0" width="960" height="720"/>
        </svg>
        <div id="box" class="c" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="box" class="fb" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="box" class="sb" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="box" class="tb" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="box" class="ss" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="box" class="lf" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="box" class="cf" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="box" class="rf" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
        <div id="box" class="dh" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
      </div>
      <div class="col-lg-6" id="plot">
      </div>
      <div class="col-lg-6" id="plot2">
      </div>
    </div>
  </div>

<!-- <script src="./multiple.min.js"></script> -->
<!-- <script src="data.js"></script> -->
<script src="app.js"></script>
</body>
</html>
